---
title:  "#5 - CNNì„ ì´ìš©í•˜ì—¬ ì†ëª¨ì–‘ AIë¥¼ ë§Œë“¤ì–´ë³´ì" 
excerpt: "í…ì„œí”Œë¡œìš° ê¸°ì´ˆ"

categories:
  -  AI
tags:
  - [AI, ê¸°ê³„í•™ìŠµ, ë”¥ëŸ¬ë‹]

last_modified_at: 2023-01-09
---


## ì†ëª¨ì–‘ êµ¬ë¶„ AI
 - ì§€ê¸ˆê¹Œì§€ ê³µë¶€í•œ CNNì„ í™œìš©í•˜ì—¬ ì†ëª¨ì–‘ êµ¬ë¶„ AIë¥¼ ê°œë°œí•˜ì.
 - í•„ìëŠ” ì•„ì§ ì‹¤ë ¥ì´ ë¶€ì¡±í•˜ì—¬ Kaggleì˜ faraz munshi ë‹˜ì´ ê°œë°œí•œ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ê°œë°œí–ˆë‹¤.
 - ë°ì´í„° ì…‹ì€ kaggleì—ì„œ ë°›ì„ ìˆ˜ ìˆìœ¼ë‹ˆ ì‚¬ìš©í•˜ì‹¤ ë¶„ë“¤ì€ ì•„ë˜ì˜ ì£¼ì†Œë¡œ ê°€ì…”ì„œ ë°›ìœ¼ì‹œê¸¸ ë°”ëë‹ˆë‹¤.
 - ë°ì´í„°ì…‹ ì£¼ì†Œ [kaggle](https://www.kaggle.com/datasets/koryakinp/fingers)

## ë°ì´í„° íŠ¹ì§•
 - í¼ì¹œ ì†ê°€ë½ì˜ ê°¯ìˆ˜ì™€ ì˜¤ë¥¸ì†, ì™¼ì†ìœ¼ë¡œ ì´ 12ê°œë¡œ êµ¬ë¶„ëœë‹¤.
 - ëª¨ë“  ë°ì´í„°ëŠ” í‘ë°±ì— (128 x 128)ì˜ ë°ì´í„° ì…‹ì´ë‹¤.
 - train ë˜ëŠ” ë°ì´í„°ì˜ ì´ ê°œìˆ˜ëŠ” 18,000ê°œ, test ë˜ëŠ” ë°ì´í„°ì˜ ì´ ê°œìˆ˜ëŠ” 3,600ê°œì´ë‹¤.
 - ë°ì´í„° ì´ ìš©ëŸ‰ì€ 177MB
 - íŒŒì¼ë³„ë¡œ ì´ë¦„ ë§¨ ë§ˆì§€ë§‰ì— ì–´ë–¤ íŒŒì¼ì¸ì§€ ë¼ë²¨ë¡œ êµ¬ë¶„ë˜ì–´ìˆë‹¤.
 - ex) íŒŒì¼ì´ë¦„_2L.png
![dataset](https://user-images.githubusercontent.com/105574034/212277858-9d57a4f6-983e-4a66-86da-de8853c91001.PNG)

## ì¶”ê°€í•  ëª¨ë“ˆ
 - ìì£¼ì‚¬ìš©í•˜ëŠ” numpy, pandas, osë¥¼ ì¶”ê°€
 - ì´ë¯¸ì§€ ì²˜ë¦¬ë¥¼ ìœ„í•´ matplotlib, cv2, PILì„ ì¶”ê°€
 - ë ˆì´ì–´ ì œì‘ì„ ìœ„í•´ tensorflowì™€ keras ì¶”ê°€ 
 - ë°ì´í„° ì „ì²˜ë¦¬ë¥¼ ìœ„í•´ sklearn, pathlibì„ ì¶”ê°€

```python
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import tensorflow as tf
from tensorflow import keras
import os
import cv2
from sklearn import preprocessing
from pathlib import Path
from PIL import Image
```

## ë°ì´í„° ì „ì²˜ë¦¬
 - ë°ì´í„° ì…‹ ë¶ˆëŸ¬ì˜¤ê¸°
 - extract_label í•¨ìˆ˜ëŠ” ë°›ì•„ì˜¬ ë°ì´í„°ì˜ ê²½ë¡œì™€ ë¼ë²¨ì„ ë¶„ë¦¬ì‹œí‚¨ë‹¤.
 - train_set_labelê³¼ test_set_labelì— ë¼ë²¨ì„ ê°ê° ë°›ì•„ì˜¨ë‹¤.
 - ë¼ë²¨ì€ ì™¼ì†ì€ L, ì˜¤ë¥¸ì†ì€ Rë¡œ í‘œì‹œí•˜ê³ , í¼ì¹œ ì†ê°€ë½ì˜ ê°œìˆ˜ê°€ í•¨ê»˜ í¬í•¨ëœë‹¤.
 - ex) 0L -> ì†ê°€ë½ì„ í•˜ë‚˜ë„ ì•ˆí¼ì¹œ ì™¼ì†

```python
#----------------------------------ë°ì´í„° ì „ì²˜ë¦¬ -------------------------------
def extract_label(base):
    #base -> í´ë” ê²½ë¡œ
    path = [] #íŒŒì¼ ê²½ë¡œ
    label = [] # 0L, 0R, 1L, 1R, 2L, 2R, 3L, 3R, 4L, 4R, 5L, 5R,
    #ë¼ë²¨ê³¼ íŒŒì¼ ê²½ë¡œ ì…ë ¥
    for filename in os.listdir(base):
        label.append(filename.split('.')[0][-2:]) #ë§¨ëì— ë¶™ì–´ìˆëŠ” ë¼ë²¨ì„ ê°€ì ¸ì˜´
        path.append(base + filename) #íŒŒì¼ ìœ„ì¹˜ì™€ íŒŒì¼ ì´ë¦„

    return path, label

#íŒŒì¼ ê²½ë¡œ
train_base  = "./../../../fingers/train/"
test_base = "./../../../fingers/test/"

#íŒŒì¼ ê²½ë¡œì™€ ë¼ë²¨ ë°›ì•„ì˜¤ê¸°
train_set_path, train_set_label = extract_label(train_base)
test_set_path, test_set_label = extract_label(test_base)

print("Number of training set examples : ", len(train_set_path))
print("Number of test set examples: ", len(test_set_path))
```
 + ì¶œë ¥ë˜ëŠ” ë°ì´í„° ê°¯ìˆ˜ë¥¼ í™•ì¸í•˜ì
    + í•™ìŠµì‹œí‚¬ ë°ì´í„° : 18,000ê°œ
    + í…ŒìŠ¤íŠ¸í•  ë°ì´í„° : 3,600ê°œ

![1](https://user-images.githubusercontent.com/105574034/212286758-e8263bd5-a831-42ef-b203-1a869d840420.PNG)

## ë°ì´í„° ë¯¸ë¦¬ë³´ê¸°
 - ì²«ë²ˆì§¸ ë°ì´í„°ë¥¼ ë¯¸ë¦¬ ë³´ê¸° í•´ë³´ì
 - matplotì—ì„œ ì§€ì›í•˜ëŠ show()ê¸°ëŠ¥ì„ í™œìš©í•˜ì—¬ ì¶œë ¥í•œë‹¤.
 - ì¶œë ¥ì— í•¨ê»˜ ë¼ë²¨ë„ í•¨ê»˜ ì¶œë ¥í–ˆë‹¤.


```python
# ì²«ë²ˆì§¸ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°-------------------------------
index = 0
image = cv2.imread(train_set_path[index])

plt.imshow(image)
plt.title(train_set_label[index], fontsize = 20)
plt.show()
```
![ë¯¸ë¦¬ë³´ê¸°](https://user-images.githubusercontent.com/105574034/212288121-40c0b879-fe40-44ea-8996-da1d4b332076.PNG)

 - 0Lì¸ ì‚¬ì§„ì´ ì •í™•í•˜ê²Œ ë‚˜ì˜¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

## ì‚¬ì§„ ë°ì´í„°ë¥¼ ìˆ«ìí™” í•˜ê¸°
 - png í˜•íƒœì˜ ì‚¬ì§„ ë°ì´í„°ëŠ” ë°”ë¡œ í…ì„œí”Œë¡œìš°ì— ë„£ì„ ìˆ˜ ì—†ë‹¤.
 - ë”°ë¼ì„œ ì‚¬ì§„ì„ í•™ìŠµ ê°€ëŠ¥í•œ í˜•íƒœë¡œ ë³€í˜•ì‹œì¼œì•¼í•œë‹¤.
 - OpenCV2ì—ì„œ ì§€ì›í•˜ëŠ” imread()ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ì§„ë°ì´í„°ë¥¼ ì´ì§„í™”ì‹œí‚¨ë‹¤.
 - íŒŒì¼ ê²½ë¡œ ë‚´ì˜ ëª¨ë“  ì‚¬ì§„ì„ ëª¨ë‘ ë„£ê¸° ìœ„í•´ ë°˜ë³µë¬¸ìœ¼ë¡œ feature_setì— ë¦¬ìŠ¤íŠ¸ í˜•íƒœë¡œ ì €ì¥í•œë‹¤.

```python
#ë°ì´í„°ë¥¼ í•™ìŠµ ê°€ëŠ¥í•œ í˜•íƒœë¡œ ë¶„ë¦¬ì‹œì¼œ ì €ì¥
def feature_data_split(path):
    feature_set = []
    for p in path:
        image = cv2.imread(p)
        feature_set.append(image)
    return feature_set

#ë°ì´í„° ë¶„ë¦¬
X_train = feature_data_split(train_set_path)
X_test = feature_data_split(test_set_path)
```

 - ë‹¨ìˆœí•œ listë¡œ ëœ ë°ì´í„°ëŠ” í…ì„œí”Œë¡œìš°ì— ë„£ì„ ìˆ˜ ì—†ë‹¤.
 - ë”°ë¼ì„œ numpy arrayí˜•íƒœë¡œ ë³€í™˜ì‹œì¼œì¤€ë‹¤.
 - numpy arrayê°€ ì–´ë–¤ í˜•íƒœì¸ì§€ í™•ì¸í•´ë³¸ë‹¤.


```python
X_train = np.array(X_train)
X_test = np.array(X_test)

print(X_train.shape)
print(X_test.shape)
```
![2](https://user-images.githubusercontent.com/105574034/212289292-867e3e34-4bfb-4e90-861b-f7ba8919e93e.PNG)
 - 128 x 128 í¬ê¸°ì˜ ì´ë¯¸ì§€, í‘ë°±(3)
 
## ë¼ë²¨ ì²˜ë¦¬
 - í˜„ì¬ ë¼ë²¨ ìƒíƒœëŠ” í•™ìŠµì— ì‚¬ìš©ì´ ë¶ˆê°€ëŠ¥í•œ í˜•íƒœì´ë‹¤.
![3](https://user-images.githubusercontent.com/105574034/212290503-07992633-0280-4328-b71f-18f7c929f095.PNG)

 - ìœ„ì—ì„œ ë°›ì•„ì˜¨ ë¼ë²¨ì„ ì •ìˆ˜ë¡œ ë°”ê¾¸ì–´ ì‚¬ìš©ê°€ëŠ¥í•˜ê²Œ í•˜ì
 - preprocessingì—ì„œ LabelEncoder()ë¥¼ ì‚¬ìš©í•˜ë©´ ë¼ë²¨ì„ ì‰½ê²Œ ì •ìˆ˜ë¡œ ë°”ê¿€ ìˆ˜ ìˆë‹¤.

```python
#--------------- ë¼ë²¨ ì²˜ë¦¬  ------------------------------

print("í•™ìŠµì‹œí‚¬ ë°ì´í„° ë¼ë²¨ :", list(np.unique(train_set_label)))
print("í…ŒìŠ¤íŠ¸í•  ë°ì´í„° ë¼ë²¨ :", list(np.unique(test_set_label)))
num_classes = len(np.unique(train_set_label))

#ë¼ë²¨ì„ ìˆ«ìë¡œ ë°”ê¾¸ê¸° ex) 0L = 1, 0R = 2
label_encoder = preprocessing.LabelEncoder()
y_train = label_encoder.fit_transform(train_set_label)
y_test = label_encoder.fit_transform(test_set_label)

print("ìˆ«ìë¡œ ë°”ë€ í•™ìŠµ   ë¼ë²¨ : ", np.unique(y_train))
print("ìˆ«ìë¡œ ë°”ë€ í…ŒìŠ¤íŠ¸ ë¼ë²¨ : ", np.unique(y_test))
```
 - ì •ìˆ˜ë¡œ ì˜ ë°”ë€ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.
![4](https://user-images.githubusercontent.com/105574034/212290926-fd766996-81c9-4668-96ad-154b580804f8.PNG)
 - ì •ìˆ˜ë¡œ ë³€í™˜ëœ ë¼ë²¨ì„ ì› í•« ì¸ì½”ë”© í•˜ì.
 - ì›í•« ì¸ì½”ë”© í•˜ë©´ í•™ìŠµì— ì‚¬ìš©ê°€ëŠ¥í•œ í˜•íƒœë¡œ ë³€í™˜ëœë‹¤.

```python
#ì› í•« ì¸ì½”ë”©
y_train = keras.utils.to_categorical(y_train, num_classes)
y_test = keras.utils.to_categorical(y_test, num_classes)

print(y_train.shape)
print(y_test.shape)
```
![5](https://user-images.githubusercontent.com/105574034/212291064-44fb86e8-a877-49e2-8799-4b4ab6690170.PNG)

## í•™ìŠµ
 + 2D ì»¨ë³¼ë£¨ì…˜ ë ˆì´ì–´ë¥¼ ì œì‘í•œë‹¤.
    + ì»¤ë„ ì‚¬ì´ì¦ˆ : 3 x 3
    + padding : í•„ìš”ì—†ìŒ('same')
    + í™œì„±í•¨ìˆ˜ : relu
    + input shape : 128 x 128ì— í‘ë°± (128, 128, 3)
    + ê°ê°ì˜ ë ˆì´ì–´ íŠ¹ì„±(ë…¸ë“œ) ê°¯ìˆ˜ : 32, 64, 128
 + 2D ì»¨ë³¼ë£¨ì…˜ ë ˆì´ì–´ ë‹¤ìŒì—ëŠ” í•­ìƒ polling layerë¥¼ ì‚½ì…
    + MaxPolling ë°©ë²• ì‚¬ìš©
    + Polling Layer í¬ê¸° : 2 x 2
 + ì»¨ë³¼ë£¨ì…˜ ë ˆì´ì–´ê°€ ëë‚˜ê³  ë‚˜ë©´ 1ì°¨ì›ìœ¼ë¡œ flatten í•´ì¤€ë‹¤.
 + Dense ë ˆì´ì–´ë¡œ ì •í™•ë„ë¥¼ ë†’íŒë‹¤.
    + ë ˆì´ì–´ íŠ¹ì„±(ë…¸ë“œ) ê°¯ìˆ˜ : 128ê°œì˜ í¬ê¸°
    + í™œì„±í•¨ìˆ˜ : relu
 + Denseë¡œ ë†’íŒ ì •í™•ë„ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì •í˜•í™”ëœ ë°ì´í„°ë¥¼ ì²˜ë‚¸ë‹¤.
    + Dropì‹œí‚¬ ë°ì´í„°ëŠ” 20%
 + ì¶œë ¥ ë ˆì´ì–´ë¡œ Denseë ˆì´ì–´ë¥¼ ì‚¬ìš©
    + ì¶œë ¥ì¸µì˜ ê°¯ìˆ˜ëŠ” ë¼ë²¨ ê°¯ìˆ˜ : 12ê°œ
    + 12ê°œë¥¼ ê°ê° 0 - 1 ì‚¬ì´ì˜ ê°’ì„ ì¶œë ¥í•˜ê¸° ìœ„í•´ í™œì„±í•¨ìˆ˜ë¡œ softmax ì‚¬ìš©

```python
model = tf.keras.Sequential([
    tf.keras.layers.Conv2D(32, (3, 3), padding = "same", activation='relu', input_shape = (128, 128, 3)),
    tf.keras.layers.MaxPool2D( (2, 2) ),
    tf.keras.layers.Conv2D(64, (3, 3), padding = "same", activation='relu', input_shape = (128, 128, 3)),
    tf.keras.layers.MaxPool2D( (2, 2) ),
    tf.keras.layers.Conv2D(128, (3, 3), padding = "same", activation='relu', input_shape = (128, 128, 3)),
    tf.keras.layers.MaxPool2D( (2, 2) ),
    tf.keras.layers.Flatten(),
    tf.keras.layers.Dense(128, activation= 'relu'),
    tf.keras.layers.Dropout(0.2),
    tf.keras.layers.Dense(num_classes, activation="softmax")
])
model.summary()
```
![6](https://user-images.githubusercontent.com/105574034/212293947-a54c8ce5-088f-4c1e-92ab-5c645fc757fc.PNG)

 + ì»´íŒŒì¼ ê³¼ì •
    + ì˜¤ì°¨ : categorical_crossentropy(ì› í•« ì¸ì½”ë”©ëœ softmax)
    + ì˜µí‹°ë§ˆì´ì € : adam
    + ê²€ì‚¬ ê²°ê³¼ : ì •í™•ë„
```python
model.compile(loss = "categorical_crossentropy", optimizer= 'adam', metrics= ['accuracy'])
```
 + í…ì„œë³´ë“œë¥¼ í™œìš©í•œ ë°ì´í„° ë¶„ì„
 + logê°’ì„ ì‹œê°„ì„ ë°”íƒ•ìœ¼ë¡œ ì €ì¥
 + fit ì‹œí‚¬ë•Œ ë°°ì¹˜ ì‚¬ì´ì¦ˆëŠ” 128, í•™ìŠµ íšŸìˆ˜ëŠ” 5íšŒë¡œ í•œë‹¤.

```python
from tensorflow.keras.callbacks import TensorBoard
import time

tensorboard = TensorBoard( log_dir = 'logs/{}'.format( 'ì²«ëª¨ë¸' + str( int( time.time()) ) ) )

model.fit(X_train, y_train, batch_size= 128, epochs=5, validation_data=(X_test, y_test), callbacks = [tensorboard])

model.save('./model1')

score = model.evaluate( X_test, y_test)
print("í…ŒìŠ¤íŠ¸ ê²°ê³¼ :", score)
```
![7](https://user-images.githubusercontent.com/105574034/212294904-3e9c84a7-7c11-4603-8ba2-1ef907b18cfc.PNG)

 - í…ì„œë³´ë“œì˜ ì •ë³´
 - íŒŒë€ìƒ‰ì´ validation, íšŒìƒ‰ì´ ì‹¤ì œ í•™ìŠµ ì •í™•ë„ì´ë‹¤.
![9](https://user-images.githubusercontent.com/105574034/212295322-b0d11574-a168-41e4-8aa4-1e1375964db0.PNG)

## ê²€ì¦
 - í•™ìŠµ ëª¨ë¸ì˜ ì •í™•ë„ê°€ ë¬´ë ¤ 1.0ì´ ë‚˜ì™”ë‹¤.
 - ì œëŒ€ë¡œëœ í•™ìŠµì´ ì´ë£¨ì–´ ì¡ŒëŠ”ì§€ í…ŒìŠ¤íŠ¸ ëª¨ë¸ê³¼ ê²€ì¦ì„ í•´ë³´ì
 - í…ŒìŠ¤íŠ¸ ë°ì´í„°ì¤‘ 100ê°œë§Œ í™•ì¸í•´ë´¤ë‹¤.
 - 100ê°œ ì¤‘ì—ì„œë„ 10ë²ˆì§¸ ë¶€í„° 20ë²ˆì§¸ê¹Œì§€ ì´ë¯¸ì§€ë¡œ í™•ì¸í•´ë³´ì

```python
model = tf.keras.models.load_model('./model1/')
sample_predictions = model.predict(X_test[:100])
sample_predictions[10:20]
fig, axs = plt.subplots( 2, 5, figsize = [24, 12])

count = 20

for i in range(2):
    for j in range(5):

        img = cv2.imread(test_set_path[count])
        results = np.argsort(sample_predictions[count])[::-1]
        labels = label_encoder.inverse_transform(results)
        
        axs[i][j].imshow(img)
        axs[i][j].set_title(labels[0], fontsize = 20)
        axs[i][j].axis('off')

        count += 1

plt.suptitle("ìƒ˜í”Œ ì˜ˆì¸¡ ê²°ê³¼ ", fontsize = 24)
plt.show()
```
![8](https://user-images.githubusercontent.com/105574034/212296132-620e2b8b-14e3-4dbe-8bc8-e6ce7852a634.PNG)
 - 10ê°œì˜ ì‚¬ì§„ ëª¨ë‘ ì •í™•í•˜ê²Œ êµ¬ë¶„í–ˆë‹¤.


## í›„ê¸°
 - í•™ìŠµ ë°©ë²•ì— ë”°ë¼ ì •í™•ë„ê°€ ë‹¤ë¥¸ê±´ ì•Œì•˜ì§€ë§Œ, 100%ê°€ ë ì¤„ì€ ëª°ëë‹¤.
 - ì—°ìŠµìœ¼ë¡œ í•˜ê¸° ì¢‹ì€ ë°ì´í„° ì…‹ê³¼ ê°„ë‹¨í•œ ë°ì´í„° ì „ì²˜ë¦¬ë¡œ ì‰½ê²Œ í•  ìˆ˜ ìˆì—ˆë‹¤.
 - ë‹¤ìŒ í¬ìŠ¤íŠ¸ëŠ” RNN ë°©ë²•ì„ ê³µë¶€ í•´ë³´ê² ìŠµë‹ˆë‹¤.

<br>

    ğŸ˜º ì˜¤íƒ€ë‚˜ ë…¼ë¦¬ì  ì˜¤ë¥˜ ì§€ì ì€ ì–¸ì œë“ ì§€ í™˜ì˜í•©ë‹ˆë‹¤!ğŸ˜º   
    í•­ìƒ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤~ ğŸ™